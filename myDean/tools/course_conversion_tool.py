from langchain.tools import tool

# Conversion dictionary from old course numbers to new course numbers
conversion_table = {
    # COSC courses
    "COSC 001": "COSC 1001",
    "COSC 005": "COSC 1005",
    "COSC 010": "COSC 1010",
    "COSC 011": "COSC 1011",
    "COSC 018": "COSC 1910",
    "COSC 019": "COSC 1021",
    "COSC 030": "COSC 1110",
    "COSC 051": "COSC 1020",
    "COSC 052": "COSC 1030",
    "COSC 125": "COSC 2310",
    "COSC 150": "COSC 2020",
    "COSC 155": "COSC 2055",
    "COSC 160": "COSC 2010",
    "COSC 220": "COSC 3030",
    "COSC 225": "COSC 3610",
    "COSC 240": "COSC 3200",
    "COSC 242": "COSC 3260",
    "COSC 245": "COSC 3250",
    "COSC 247": "COSC 3230",
    "COSC 248": "COSC 3240",
    "COSC 252": "COSC 3010",
    "COSC 253": "COSC 3810",
    "COSC 255": "COSC 3020",
    "COSC 260": "COSC 3290",
    "COSC 270": "COSC 3450",
    "COSC 272": "COSC 3400",
    "COSC 280": "COSC 3510",
    "COSC 282": "COSC 3570",
    "COSC 285": "COSC 3590",
    "COSC 287": "COSC 3430",
    "COSC 288": "COSC 3460",
    "COSC 289": "COSC 3440",
    "COSC 301": "COSC 4949",
    "COSC 430": "COSC 4700",
    "COSC 435": "COSC 4705",
    "COSC 438": "COSC 4710",
    "COSC 455": "COSC 4410",
    "COSC 470": "COSC 4420",
    "COSC 475": "COSC 4415",
    "COSC 482": "COSC 4462",
    "COSC 483": "COSC 4463",
    "COSC 488": "COSC 4550",
    "COSC 520": "COSC 5310",
    "COSC 521": "COSC 5521",
    "COSC 523": "COSC 5275",
    "COSC 525": "COSC 5610",
    "COSC 530": "COSC 5290",
    "COSC 531": "COSC 5740",
    "COSC 534": "COSC 5745",
    "COSC 535": "COSC 5750",
    "COSC 536": "COSC 5760",
    "COSC 537": "COSC 5770",
    "COSC 538": "COSC 5780",
    "COSC 540": "COSC 5200",
    "COSC 542": "COSC 5220",
    "COSC 543": "COSC 5230",
    "COSC 544": "COSC 5240",
    "COSC 545": "COSC 5250",
    "COSC 546": "COSC 5260",
    "COSC 547": "COSC 5270",
    "COSC 548": "COSC 5210",
    "COSC 549": "COSC 5280",
    "COSC 550": "COSC 5110",
    "COSC 560": "COSC 5620",
    "COSC 570": "COSC 5571",
    "COSC 572": "COSC 5402",
    "COSC 574": "COSC 5440",
    "COSC 575": "COSC 5460",
    "COSC 576": "COSC 5455",
    "COSC 577": "COSC 5560",
    "COSC 578": "COSC 5450",
    "COSC 580": "COSC 5510",
    "COSC 586": "COSC 5540",
    "COSC 587": "COSC 5580",
    "COSC 588": "COSC 5570",
    "COSC 589": "COSC 5520",
    "COSC 592": "COSC 5530",
    "COSC 672": "COSC 8422",
    "COSC 688": "COSC 6480",
    "COSC 689": "COSC 6440",
    "COSC 824": "COSC 8710",
    "COSC 830": "COSC 8290",
    "COSC 831": "COSC 8740",
    "COSC 835": "COSC 8720",
    "COSC 841": "COSC 8730",
    "COSC 845": "COSC 8410",
    "COSC 846": "COSC 8220",
    "COSC 848": "COSC 8260",
    "COSC 872": "COSC 8405",
    "COSC 878": "COSC 8480",
    "COSC 880": "COSC 8525",
    "COSC 883": "COSC 8530",
    "COSC 901": "COSC 7949",
    "COSC 991": "COSC 9991",
    "COSC 992": "COSC 9992",
    "COSC 993": "COSC 9993",
    "COSC 994": "COSC 9994",
    "COSC 999": "COSC 9999",
    
    # MATH courses
    "MATH 001": "MATH 1001",
    "MATH 004": "MATH 1004",
    "MATH 04-": "MATH 104X",
    "MATH 031": "MATH 1310",
    "MATH 032": "MATH 1320",
    "MATH 035": "MATH 1350",
    "MATH 036": "MATH 1360",
    "MATH 040": "MATH 1040",
    "MATH 105": "MATH 1505",
    "MATH 110": "MATH 1510",
    "MATH 137": "MATH 2370",
    "MATH 140": "MATH 2140",
    "MATH 150": "MATH 2250",
    "MATH 200": "MATH 2800",
    "MATH 201": "MATH 2410",
    "MATH 203": "MATH 2420",
    "MATH 205": "MATH 3300",
    "MATH 211": "MATH 3200",
    "MATH 215": "MATH 3210",
    "MATH 220": "MATH 2010",
    "MATH 221": "MATH 2020",
    "MATH 230": "MATH 2430",
    "MATH 240": "MATH 2540",
    "MATH 245": "MATH 2620",
    "MATH 261": "MATH 2110",
    "MATH 262": "MATH 2460",
    "MATH 301": "MATH 4949",
    "MATH 310": "MATH 3310",
    "MATH 311": "MATH 4310",
    "MATH 314": "MATH 2490",
    "MATH 315": "MATH 4100",  
    "MATH 316": "MATH 3320",  
    "MATH 320": "MATH 4110",
    "MATH 325": "MATH 2625",
    "MATH 340": "MATH 2640",
    "MATH 345": "MATH 2645",
    "MATH 401": "MATH 4311", 
    "MATH 412": "MATH 4307",  
    "MATH 425": "MATH 4314",  
    "MATH 426": "MATH 5001",
    "MATH 442": "MATH 5005",
    "MATH 471": "MATH 4531",  
    "MATH 472": "MATH 4532", 
    "MATH 473": "MATH 5034",
    "MATH 474": "MATH 4533",  
    "MATH 480": "MATH 4540",  
    "MATH 481": "MATH 4541",  
    "MATH 501": "MATH 5051",
    "MATH 502": "MATH 5052",
    "MATH 503": "MATH 5151",
    "MATH 504": "MATH 5152",
    "MATH 510": "MATH 5200",
    "MATH 511": "MATH 5210",
    "MATH 513": "MATH 5070",
    "MATH 514": "MATH 5310",
    "MATH 517": "MATH 5340",
    "MATH 558": "MATH 5061",
    "MATH 605": "MATH 5420",
    "MATH 611": "MATH 5710",
    "MATH 615": "MATH 5410",
    "MATH 640": "MATH 5600",
    "MATH 642": "MATH 5320",
    "MATH 644": "MATH 5700",
    "MATH 645": "MATH 5520",
    "MATH 651": "MATH 5500",
    "MATH 652": "MATH 5530",
    "MATH 656": "MATH 5330",
    "MATH 658": "MATH 5060",
    "MATH 661": "MATH 5510",
    "MATH 671": "MATH 8100",
    "MATH 672": "MATH 8110",
    "MATH 673": "MATH 8120",
    "MATH 674": "MATH 8130",
    "MATH 680": "MATH 8200",
    "MATH 681": "MATH 8250",
    "MATH 818": "MATH 8180",
    "MATH 826": "MATH 8260",
    "MATH 901": "MATH 7949",
    "MATH 905": "MATH 5925",
    "MATH 991": "MATH 9991",
    "MATH 992": "MATH 9992",
    "MATH 993": "MATH 9993",
    "MATH 994": "MATH 9994",
    "MATH 999": "MATH 9999"
}

def normalize_course_numbers(course_list):
    """Core function to convert course numbers from old format to new format."""
    normalized_list = []
    for course in course_list:
        # Skip invalid formats
        if '--' in course:
            continue
            
        # Convert hyphenated format to space format for lookup
        space_format = course.replace('-', ' ')
        
        # If the course is already in the new format (4-digit number), keep it as is
        if any(str(i) in space_format.split()[-1] for i in range(1000, 10000)):
            normalized_list.append(course)  # Keep original format
        else:
            # Try to normalize the course
            normalized = conversion_table.get(space_format, space_format)
            # Convert back to hyphen format if input was hyphenated
            if '-' in course:
                normalized = normalized.replace(' ', '-')
            # Only add if it was successfully normalized
            if normalized != course or any(str(i) in normalized.replace('-', ' ').split()[-1] for i in range(1000, 10000)):
                normalized_list.append(normalized)
    
    return normalized_list

@tool
def normalize_courses(course_list):
    """Tool for converting course numbers from old format to new format."""
    return normalize_course_numbers(course_list)